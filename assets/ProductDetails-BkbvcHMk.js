import{u as Q,r as a,e as U,j as e,L as E}from"./index-2BCN79Ve.js";import{L as b,B as z}from"./Layout-CsdtjW8y.js";import{a as X}from"./supabase-C5sOXNJb.js";import{a as G}from"./supabaseCards-Cl2hf8Ed.js";import{l as W,c as V}from"./supabaseReviews-DKmkBXuH.js";import{m as o}from"./proxy-DhgIlT5W.js";import"./supabaseClient-whyNr3HJ.js";import"./tslib.es6-CmEaCU22.js";const Z=({buttonRef:m})=>{const[d,y]=a.useState([]);return a.useEffect(()=>{if(!m.current)return;const i=m.current.getBoundingClientRect(),j=i.left+i.width/2,x=i.top+i.height/2,v=[...Array(30)].map((h,f)=>({id:f,x:j+(Math.random()-.5)*i.width,y:x+(Math.random()-.5)*i.height,color:["#ec4899","#f97316","#eab308","#22c55e","#3b82f6","#8b5cf6"][Math.floor(Math.random()*6)]}));y(v)},[m]),e.jsx("div",{className:"fixed inset-0 pointer-events-none z-50",children:d.map(i=>e.jsx(o.div,{initial:{x:i.x,y:i.y,scale:0,rotate:0},animate:{x:i.x+(Math.random()-.5)*200,y:i.y+(Math.random()-.5)*200,scale:1,rotate:Math.random()*360,opacity:0},transition:{duration:1.5,ease:"easeOut"},className:"absolute w-2 h-2 rounded-full",style:{backgroundColor:i.color}},i.id))})},le=()=>{const{id:m}=Q(),d=Number(m),[y,i]=a.useState(null),[j,x]=a.useState(!0),{addItem:v}=U(),[h,f]=a.useState(0),[$,N]=a.useState(!1),[Y,w]=a.useState(!1),[S,D]=a.useState(!0),[u,H]=a.useState(""),[k,O]=a.useState(150),[c,C]=a.useState([]),[l,R]=a.useState(null),[p,A]=a.useState(""),[q,L]=a.useState(!1),[g,T]=a.useState(1),[J,M]=a.useState(!1),_=a.useRef(null),I=t=>t?t.startsWith("data:image/")||t.startsWith("http://")||t.startsWith("https://"):!1,s=y;a.useEffect(()=>{try{const t=localStorage.getItem("phool_custom_message_limit");t&&O(Number(t)||150)}catch{}},[]),a.useEffect(()=>{(async()=>{if(x(!0),!Number.isFinite(d)){i(null),x(!1);return}const[t,r]=await Promise.all([X(d),G(d)]);i(t??r),x(!1)})()},[d]),a.useEffect(()=>{s&&(async()=>{const t=await W(s.id);C(t)})()},[s==null?void 0:s.id]),a.useEffect(()=>{if(!S||!s)return;const t=s.images;if(!t||t.length===0)return;const r=setInterval(()=>{f(n=>(n+1)%t.length)},3500);return()=>clearInterval(r)},[s,S]);const F=()=>{v({id:s.id,name:s.name,price:s.price,image:s.images[0],customText:s.is_custom?u:void 0},g),N(!0),w(!0),M(!0),setTimeout(()=>w(!1),900),setTimeout(()=>N(!1),1400),setTimeout(()=>M(!1),3e3)},P=c.length?Math.round(c.reduce((t,r)=>t+r.rating,0)/c.length*10)/10:0,K=async t=>{if(t.preventDefault(),!l)return;const r=p.trim().slice(0,150);await V({product_id:s.id,name:"Anonymous",rating:l,comment:r,approved:!0});const n=await W(s.id);C(n),R(null),A(""),L(!0),setTimeout(()=>L(!1),1200)};return j?e.jsx(b,{children:e.jsx("div",{className:"container py-24 text-center text-muted-foreground",children:"Loading product..."})}):s?e.jsxs(b,{children:[J&&e.jsx(Z,{buttonRef:_}),e.jsx("section",{className:"min-h-screen bg-neutral-50",children:e.jsxs("div",{className:"container max-w-6xl mx-auto px-6 py-12",children:[e.jsx("nav",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(E,{to:"/",className:"hover:text-foreground transition-colors",children:"Home"}),e.jsx("span",{children:"/"}),e.jsx(E,{to:"/catalog",className:"hover:text-foreground transition-colors",children:"Catalog"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-foreground font-medium",children:s.name})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16 items-start",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"bg-white rounded-3xl p-8 shadow-sm",children:[e.jsxs("div",{className:"relative aspect-square overflow-hidden rounded-2xl bg-gray-50",children:[e.jsx(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,ease:"easeOut"},className:"w-full h-full",children:(()=>{const r=(typeof s.images=="string"?JSON.parse(s.images||"[]"):s.images)[h];return I(r)?e.jsx("img",{src:r,alt:s.name,className:"w-full h-full object-cover transition-transform duration-700 hover:scale-105",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-8xl",children:r})})()},h),Y&&e.jsx(o.div,{initial:{opacity:0,scale:.6,y:20},animate:{opacity:1,scale:1.2,y:-40},exit:{opacity:0},transition:{duration:.9},className:"pointer-events-none absolute top-8 right-8 text-5xl",children:"ðŸ’Œ"})]}),(()=>{const t=typeof s.images=="string"?JSON.parse(s.images||"[]"):s.images;return t.length<=1?null:e.jsx("div",{className:"mt-6 flex gap-3 justify-center",children:t.map((r,n)=>e.jsx("button",{onClick:()=>{f(n),D(!1)},className:`rounded-xl overflow-hidden transition-all duration-300 ${n===h?"ring-2 ring-primary ring-offset-2 scale-110":"opacity-60 hover:opacity-100"}`,"aria-label":`Show image ${n+1}`,children:I(r)?e.jsx("img",{src:r,alt:s.name,className:"w-16 h-16 object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-2xl bg-gray-100",children:r})},n))})})()]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx("h1",{className:"font-display text-5xl lg:text-6xl font-bold text-foreground leading-tight",children:s.name})}),e.jsx("div",{className:"flex items-baseline space-x-4",children:e.jsxs("span",{className:"text-4xl font-bold text-foreground",children:["PKR ",s.price]})}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Handmade with Love"}),e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"â€¢ In Stock"})]})]}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"prose prose-lg prose-neutral max-w-none",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed text-lg",children:s.description})}),s.is_custom&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-semibold text-foreground uppercase tracking-wide",children:"Personalize Your Message"}),e.jsx("textarea",{value:u,onChange:t=>H(t.target.value),className:"w-full rounded-2xl border border-gray-200 p-4 text-base focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none",rows:3,placeholder:"Write your heartfelt message here..."}),e.jsxs("div",{className:"text-sm text-muted-foreground text-right",children:[u.length,"/",k," characters"]})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center rounded-2xl border border-gray-200",children:[e.jsx("button",{onClick:()=>T(Math.max(1,g-1)),className:"p-3 text-foreground hover:bg-gray-50 transition-colors rounded-l-2xl",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx("span",{className:"px-6 py-3 text-center font-semibold min-w-[60px]",children:g}),e.jsx("button",{onClick:()=>T(g+1),className:"p-3 text-foreground hover:bg-gray-50 transition-colors rounded-r-2xl",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsx(z,{ref:_,size:"lg",className:"rounded-full px-12 py-6 text-lg font-semibold bg-primary hover:bg-primary/90 transition-all transform hover:scale-105 shadow-lg",onClick:F,disabled:s.is_custom&&(u.trim().length===0||u.length>k),children:$?"âœ“ Added to Tokri":s.is_custom?"Add Card to Tokri":"Add to Tokri"})})]})]})]}),e.jsx(o.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.8,delay:.6},className:"mt-24 border-t border-gray-200 pt-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h2",{className:"font-display text-3xl font-bold text-foreground mb-8",children:"Customer Reviews"}),e.jsx("div",{className:"flex items-center justify-between mb-12 pb-8 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"text-5xl font-bold text-foreground",children:P||"â€”"}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-1 mb-2",children:Array.from({length:5}).map((t,r)=>{const n=r<Math.round(P);return e.jsx("span",{className:`${n?"text-primary":"text-gray-300"} text-2xl`,children:n?"â™¥":"â™¡"},r)})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[c.length," review",c.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"space-y-8 mb-16",children:[c.map(t=>e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border-b border-gray-100 pb-8 last:border-0",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[e.jsx("div",{className:"font-semibold text-foreground",children:t.name}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:5}).map((r,n)=>{const B=n<t.rating;return e.jsx("span",{className:`${B?"text-primary":"text-gray-300"} text-lg`,children:B?"â™¥":"â™¡"},n)})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(t.created_at||"").toLocaleDateString()})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:t.comment})]})})},t.id)),c.length===0&&e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ’¬"}),e.jsx("p",{className:"text-lg",children:"No reviews yet. Be the first to share your thoughts!"})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-8 border border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-6",children:"Share Your Experience"}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-foreground uppercase tracking-wide block mb-3",children:"Your Rating"}),e.jsx("div",{className:"flex items-center space-x-3",children:[1,2,3,4,5].map(t=>e.jsx(o.button,{type:"button",onClick:()=>R(t),"aria-label":`${t} heart`,whileTap:{scale:.9},className:"focus:outline-none focus-visible:ring-2 focus-visible:ring-primary rounded-xl p-2",children:e.jsx(o.span,{animate:l&&l>=t?{scale:1.25}:{scale:1},transition:{type:"spring",stiffness:500,damping:18},className:`${l&&l>=t?"text-primary":"text-gray-300"} text-4xl`,children:l&&l>=t?"â™¥":"â™¡"})},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-foreground uppercase tracking-wide block mb-3",children:"Your Review"}),e.jsx("textarea",{maxLength:150,value:p,onChange:t=>A(t.target.value),className:"w-full rounded-2xl border border-gray-200 p-4 text-base focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none",rows:4,placeholder:"Tell us about your experience with this product..."}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground text-right",children:[p.length,"/150 characters"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{type:"submit",disabled:!l||p.trim().length===0,className:"rounded-full px-8 py-4 font-semibold bg-primary hover:bg-primary/90 transition-all",children:"Submit Review"}),q&&e.jsx(o.div,{initial:{scale:.6,opacity:0},animate:{scale:1.05,opacity:1},transition:{duration:.35},className:"text-primary font-semibold",children:"ðŸŽ‰ Review posted!"})]})]})]})]})})]})})]}):e.jsx(b,{children:e.jsx("div",{className:"py-24 text-center",children:"Product not found."})})};export{le as default};
