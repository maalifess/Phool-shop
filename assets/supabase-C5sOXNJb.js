import{s as u,c as d}from"./supabaseClient-whyNr3HJ.js";const l=6e4;let e=null,i=null;async function g(){const r=Date.now();if(e&&r-e.ts<l)return e.data;if(i)return i;i=(async()=>{const{data:t,error:a}=await u.from("Products").select("*").order("created_at",{ascending:!1});if(a)return console.error("Failed to load products from Supabase",a),(e==null?void 0:e.data)??[];const n=(t||[]).map(s=>{const o=typeof s.images=="string"?(()=>{try{return JSON.parse(s.images||"[]")}catch{return[]}})():s.images;return{...s,images:o}});return e={ts:Date.now(),data:n},n})();try{return await i}finally{i=null}}async function y(r){if(!Number.isFinite(r))return null;if(e){const o=e.data.find(c=>c.id===r);if(o)return o}const{data:t,error:a}=await u.from("Products").select("*").eq("id",r).maybeSingle();if(a)return console.error("Failed to load product from Supabase",a),null;if(!t)return null;const n=typeof t.images=="string"?(()=>{try{return JSON.parse(t.images||"[]")}catch{return[]}})():t.images,s={...t,images:n};if(e){const o=e.data.findIndex(c=>c.id===r);if(o>=0){const c=[...e.data];c[o]=s,e={ts:e.ts,data:c}}}return s}async function I(r){const{data:t,error:a}=await u.from("Products").insert(r).select().single();return a?(console.error("Failed to create product",a),null):t}async function b(r,t){const{data:a,error:n}=await u.from("Products").update(t).eq("id",r).select().single();return n?(console.error("Failed to update product",n),null):a}async function w(r){const{error:t}=await u.from("Products").delete().eq("id",r);return t?(console.error("Failed to delete product",t),!1):!0}const f="https://nafwdpmmbphogdctsktq.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hZndkcG1tYnBob2dkY3Rza3RxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mjg4MDksImV4cCI6MjA4NzAwNDgwOX0.rnmsiP9mrzzmMasYQppUOSnpCZiTKnyT0oHOeUdGOeA",P=d(f,m);export{y as a,I as c,w as d,g as l,P as s,b as u};
