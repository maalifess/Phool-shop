# Supabase Schema for Phool Shop

## Tables to Create

### 1. Cards Table
```sql
CREATE TABLE public.cards (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  price INT NOT NULL,
  category TEXT DEFAULT 'Cards',
  images TEXT[] DEFAULT ARRAY[]::TEXT[],
  description TEXT DEFAULT '',
  in_stock BOOLEAN DEFAULT true,
  is_custom BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.cards ENABLE ROW LEVEL SECURITY;

-- Policies
CREATE POLICY "Admins can do everything" ON public.cards FOR ALL USING (
  auth.role() = 'authenticated'
);

CREATE POLICY "Public read cards" ON public.cards FOR SELECT USING (true);
```

### 2. Fundraisers Table
```sql
CREATE TABLE public.fundraisers (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT NOT NULL,
  description TEXT DEFAULT '',
  goal TEXT NOT NULL,
  active BOOLEAN DEFAULT true,
  product_id BIGINT REFERENCES public.products(id) ON DELETE SET NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.fundraisers ENABLE ROW LEVEL SECURITY;

-- Policies
CREATE POLICY "Admins can do everything" ON public.fundraisers FOR ALL USING (
  auth.role() = 'authenticated'
);

CREATE POLICY "Public read fundraisers" ON public.fundraisers FOR SELECT USING (true);
```

### 3. Reviews Table
```sql
CREATE TABLE public.reviews (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  product_id BIGINT NOT NULL REFERENCES public.products(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  rating INT NOT NULL CHECK (rating >= 1 AND rating <= 5),
  comment TEXT DEFAULT '',
  approved BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.reviews ENABLE ROW LEVEL SECURITY;

-- Policies
CREATE POLICY "Admins can do everything" ON public.reviews FOR ALL USING (
  auth.role() = 'authenticated'
);

CREATE POLICY "Public read approved reviews" ON public.reviews FOR SELECT USING (approved = true);
```

## What I Need From You

### 1. Supabase Project URL & Anon Key
- Go to Supabase → Settings → API
- Copy **Project URL** and **anon public** key
- Paste them here

### 2. Confirm Tables Created
- In Supabase → **SQL Editor**, run the CREATE TABLE statements above
- Confirm you see `cards`, `fundraisers`, and `reviews` tables in the Table Editor

### 3. Optional: Existing Data Migration
If you have existing cards/fundraisers/reviews in localStorage, let me know and I'll write a migration script.

## Next Steps After You Provide
1. I'll create TypeScript types for the new tables
2. Update AdminDashboard to use Supabase for cards/fundraisers
3. Add review management to AdminDashboard
4. Update ProductDetails to fetch reviews from Supabase
5. Add review submission form to ProductDetails

## Notes
- All tables have RLS (Row Level Security) enabled
- Admins (authenticated users) can do everything
- Public users can read approved data only
- Foreign key relationships maintain data integrity
